
<div>
    <div
        data-list="{&quot;valueNames&quot;:[&quot;ponum&quot;,&quot;stonum&quot;,&quot;booking&quot;,&quot;container&quot;,&quot;podnum&quot;,&quot;currentstat&quot;,&quot;eta&quot;,&quot;provider&quot;,&quot;currentloc&quot;,&quot;datediff&quot;,&quot;status&quot;],&quot;page&quot;:10}">
        <div class="row gx-0 gy-3 align-items-center py-4">
            <div class="col-xl-auto">
                <h3 class="mb-0">Shipment Tracking </h3>
            </div>
            <div class="col-auto flex-1">
                <div class="d-flex flex-between-center">
                    <div class="d-flex align-items-center">
                        <div class="search-box ms-xl-6 w-auto">
                            <form class="position-relative"><input class="form-control search-input search" type="search"
                                    placeholder="Search..." aria-label="Search">
                                <svg class="svg-inline--fa fa-magnifying-glass search-box-icon" aria-hidden="true"
                                    focusable="false" data-prefix="fas" data-icon="magnifying-glass" role="img"
                                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                                    <path fill="currentColor"
                                        d="M500.3 443.7l-119.7-119.7c27.22-40.41 40.65-90.9 33.46-144.7C401.8 87.79 326.8 13.32 235.2 1.723C99.01-15.51-15.51 99.01 1.724 235.2c11.6 91.64 86.08 166.7 177.6 178.9c53.8 7.189 104.3-6.236 144.7-33.46l119.7 119.7c15.62 15.62 40.95 15.62 56.57 0C515.9 484.7 515.9 459.3 500.3 443.7zM79.1 208c0-70.58 57.42-128 128-128s128 57.42 128 128c0 70.58-57.42 128-128 128S79.1 278.6 79.1 208z">
                                    </path>
                                </svg><!-- <span class="fas fa-search search-box-icon"></span> Font Awesome fontawesome.com -->
                            </form>
                        </div>

                    </div>
                    <div class="d-flex align-items-center">
                        <div class="pagination d-none"></div>
                        <p class="mb-0 d-none d-md-block me-3 fw-semibold text-body text-nowrap"
                            data-list-info="data-list-info">1 to 4 <span class="text-body-tertiary"> Items of </span>5
                        </p><a class="fw-semibold text-nowrap d-none d-sm-block" href="#!" data-list-view="*">View
                            all<svg class="svg-inline--fa fa-angle-right ms-1" data-fa-transform="down-1"
                                aria-hidden="true" focusable="false" data-prefix="fas" data-icon="angle-right"
                                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512" data-fa-i2svg=""
                                style="transform-origin: 0.25em 0.5625em;">
                                <g transform="translate(128 256)">
                                    <g transform="translate(0, 32)  scale(1, 1)  rotate(0 0 0)">
                                        <path fill="currentColor"
                                            d="M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"
                                            transform="translate(-128 -256)"></path>
                                    </g>
                                </g>
                            </svg><!-- <span class="fas fa-angle-right ms-1" data-fa-transform="down-1"></span> Font Awesome fontawesome.com --></a><a
                            class="fw-semibold d-none text-nowrap" href="#!" data-list-view="less">View
                            Less</a><button class="btn btn-phoenix-primary px-3 me-1 ms-sm-4 disabled" type="button"
                            title="Previous" data-list-pagination="prev" disabled=""><svg
                                class="svg-inline--fa fa-chevron-left" data-fa-transform="down-1" aria-hidden="true"
                                focusable="false" data-prefix="fas" data-icon="chevron-left" role="img"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" data-fa-i2svg=""
                                style="transform-origin: 0.3125em 0.5625em;">
                                <g transform="translate(160 256)">
                                    <g transform="translate(0, 32)  scale(1, 1)  rotate(0 0 0)">
                                        <path fill="currentColor"
                                            d="M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"
                                            transform="translate(-160 -256)"></path>
                                    </g>
                                </g>
                            </svg><!-- <span class="fas fa-chevron-left" data-fa-transform="down-1"></span> Font Awesome fontawesome.com --></button><button
                            class="btn btn-phoenix-primary px-3" type="button" title="Next"
                            data-list-pagination="next"><svg class="svg-inline--fa fa-chevron-right"
                                data-fa-transform="down-1" aria-hidden="true" focusable="false" data-prefix="fas"
                                data-icon="chevron-right" role="img" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 320 512" data-fa-i2svg="" style="transform-origin: 0.3125em 0.5625em;">
                                <g transform="translate(160 256)">
                                    <g transform="translate(0, 32)  scale(1, 1)  rotate(0 0 0)">
                                        <path fill="currentColor"
                                            d="M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"
                                            transform="translate(-160 -256)"></path>
                                    </g>
                                </g>
                            </svg><!-- <span class="fas fa-chevron-right" data-fa-transform="down-1"></span> Font Awesome fontawesome.com --></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="table-responsive scrollbar mx-n1 px-1 mb-4">
            <table class="table fs-9 mb-0 border-top border-translucent" wire:ignore>
                <thead>
                    <tr class="text-center">
                        <th class="sort align-middle" scope="col" data-sort="ponum" style="min-width:150px;">PO
                            NO.</th>
                        <th class="sort align-middle " scope="col" data-sort="stonum" style="min-width:150px;">
                            STO NO.</th>
                        <th class="sort align-middle " scope="col" data-sort="provider" style="min-width:125px;">
                            PROVIDER
                        </th>
                        <th class="sort align-middle " scope="col" data-sort="booking" style="min-width:150px;">
                            BOOKING NO. </th>
                        <th class="sort align-middle " scope="col" data-sort="container"
                            style="min-width:150px;">CONTAINER NO.</th>
                        <th class="sort align-middle " scope="col" data-sort="eta" style="min-width:125px;">ETA
                            TO POD
                        </th>
                        <th class="sort align-middle " scope="col" data-sort="podnum" style="min-width:150px;">
                            POD</th>

                        <th class="sort align-middle " scope="col" data-sort="currentloc"
                            style="min-width:150px;">NEXT DESTINATION</th>
                        <th class="sort align-middle " scope="col" data-sort="currentstat"
                            style="min-width:200px;">CURRENT STATUS</th>


                        <th class="sort align-middle " scope="col" data-sort="currentloc"
                            style="min-width:120px;">LEAD TIME</th>
                        <th class="sort align-middle " scope="col" data-sort="status" style="min-width:150px;">
                            STATUS</th>

                    </tr>
                </thead>
                <tbody class="list" id="table-flights-body">
                    @foreach ($bookings as $booking)
                        @php
                            // Get the status_date
                            $dateBookedString = optional($booking->bookingoldest)->status_date;
                            $dateDifference = null;
                            if (!empty($dateBookedString)) {
                                try {
                                    // Parse the date with the given format
                                    $dateBooked = \Carbon\Carbon::createFromFormat('d/m/Y', $dateBookedString);
                                    $today = \Carbon\Carbon::now('Asia/Manila');
                                    // Calculate the difference in days
                                    $dateDifference = $dateBooked->diffInDays($today);
                                } catch (\Exception $e) {
                                    // Log the error if needed
                                    \Log::error('Failed to parse date: ' . $e->getMessage());
                                }
                            }
                        @endphp
                        <tr class="text-center">

                            <td class="align-middle ponum ps-0"><a class="fw-bold" data-bs-toggle="modal"
                                    data-bs-target="#staticBackdrop"
                                    onclick="getdetails({{ $booking->booking_id }})">#{{ $booking->booking->customer_po }}</a>
                            </td>
                            <td class="align-middle stonum ps-0">{{ $booking->booking->sto_number }}</td>
                            <td class="align-middle provider ps-0">{{ $booking->booking->forwarder }}</td>
                            <td class="align-middle booking ps-0">{{ $booking->booking->booking_number }}</td>
                            <td class="align-middle container ps-0">{{ $booking->booking->container_number }}</td>
                            <td class="align-middle eta ps-0">{{ $booking->eta ?? 'No Cargo Yet' }}</td>
                            <td class="align-middle pdonum ps-0">{{ $booking->pod }}</td>
                            <td class="align-middle currentloc">
                                {{ optional($booking->bookingLatest)->status_loc ?? 'N/A' }}</td>
                            <td class="align-middle currentstat ps-0">
                                {{ optional($booking->bookingLatest)->status_desc ?? 'N/A' }}</td>

                            <td class="align-middle currentloc">
                                {{ $dateDifference }}</td>
                            <td class="align-middle status ps-0">
                                @if ($dateDifference > 60)
                                    <span class="badge badge-phoenix fs-10 badge-phoenix-danger"> Delayed
                                    @else
                                        <span class="badge badge-phoenix fs-10 badge-phoenix-success"> On Time
                                @endif
                                </span>
                            </td>

                        </tr>
                    @endforeach


                </tbody>
            </table>
        </div>

    </div>

    <div class="modal fade" id="staticBackdrop" tabindex="-1" aria-labelledby="staticBackdropLabel"
        aria-hidden="true" wire:ignore.self>
        <div class="modal-dialog modal-md">
            <div class="modal-content ">
                <div class="modal-header bg-primary">
                    <h5 class="modal-title text-white dark__text-gray-1100" id="staticBackdropLabel">Booking History
                    </h5>
                    <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close"><span
                            class="fas fa-times fs-9 text-white dark__text-gray-1100"></span></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-5">
                            <div class="container-wrapper">
                                <div class="timeline-container fw-semibold">
                                    <h3 class="mt-3">{{$bookingid}}</h3>

                                    <div class="card-header mt-5">
                                        <div class="row mb-2">
                                            <div class="col">
                                                <label>Booking Number:</label>
                                            </div>
                                            <div class="col">
                                                <label class="fw-bold" id="battype">{{ $details->booking_number ?? '' }}</label>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col">
                                                <label>STO Number:</label>
                                            </div>
                                            <div class="col">
                                                <label class="fw-bold" id="battype">{{ $details->sto_number ?? '' }}</label>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col">
                                                <label>PO Number:</label>
                                            </div>
                                            <div class="col">
                                                <label class="fw-bold" id="projnamae">{{ $details->customer_po ?? '' }}</label>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col">
                                                <label>Date Booked:</label>
                                            </div>
                                            <div class="col">
                                                <label class="fw-bold" id="requser">{{ isset($details->date_booked) ? $details->date_booked->format('Y-m-d') : '' }}
                                                </label>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col">
                                                <label>Items:</label>
                                            </div>
                                            <div class="col">
                                                <label class="fw-bold" id="testreq">Battery {{ $details->batts_qty ?? '' }} pcs</label>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col">
                                                <label>Forwarder:</label>
                                            </div>
                                            <div class="col">
                                                <label class="fw-bold" id="projnamae">{{ $details->forwarder ?? '' }}</label>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col">
                                                <label>Carrier:</label>
                                            </div>
                                            <div class="col">
                                                <label class="fw-bold" id="projnamae">{{ $details->carrier ?? '' }}</label>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div id="map"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="container-wrapper timeline_container mx-3 mt-3" style="max-height: 60vh; overflow: auto;">
                                <div class="timeline_container mb-5">
                                    <ul class="mx-3">
                                        @if (isset($data))
                                            @foreach ($data as $timeline)
                                                <li>
                                                    <span></span>
                                                    <div>
                                                        <div class="h6"></div>
                                                        <div class="type">Status: <br><b
                                                                class="text-primary">{{ $timeline['status_desc'] }}</b>
                                                        </div>

                                                            <div class="row mb-2">
                                                                <div class="col-md-6">
                                                                    <div class="type">
                                                                        {{--  <br><b>{{ $timeline['eta_ata'] }}</b>  --}}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="type">Current Location:
                                                                <br><b>{{ $timeline['status_loc'] }}</b>
                                                            </div>

                                                    </div>
                                                    <span class="number">
                                                        <span></span>
                                                        <span class="mt-3">{{ $timeline['status_date'] }}</span>
                                                    </span>
                                                </li>
                                            @endforeach
                                        @endif
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>



                </div>
                <div class="modal-footer"><button class="btn btn-outline-primary" type="button"
                        data-bs-dismiss="modal">Close</button></div>
            </div>
        </div>
    </div>
</div>
<script>
    function getdetails(id) {
        Livewire.emit("getdetails", id);
    }

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
</script>
